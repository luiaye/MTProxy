# 🚀 Telegram MTProto Proxy 一键管理脚本

适用于 Ubuntu / Debian 系统，全面兼容 **x86_64** 与 **ARM64 (aarch64)** 架构。
本项目提供一键交互式管理菜单，集成了 **Go语言版 (mtg)** 与 **官方 C语言版 (修改版)**，无论你是追求极致抗封锁还是超低延迟，只需一个脚本即可随意切换！

---

## ✨ 核心特性

- 🟢 **多版本自由切换**：内置 Go 语言版和官方 C 语言版，一键卸载旧版、安装新版，杜绝端口冲突。
- 🛡️ **动态生成密钥**：每次安装均调用 OpenSSL 生成全新的 16 字节随机 Secret，拒绝硬编码。
- 🔧 **高 PID 崩溃修复**：自动为官方 C 语言版打上 Python 热补丁，解决现代 Linux 系统上 `PID > 65535` 导致的假死闪退 Bug。
- ⚙️ **ARM 架构完美适配**：自动识别 `aarch64`，剥离 x86 独占指令集（`-mpclmul`, `-mssse3` 等），并自动替换底层内联汇编（`rdtsc` -> `cntvct_el0`）。

---

## ⚖️ 版本选择指南：我该选菜单几？

| 选项 | 版本核心 | 延迟表现 | 抗封锁能力 | Fake-TLS 伪装 | 适用场景 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **[1]** | 🐹 Go 语言版 (`mtg`) | 较高  | **极强 (防主动探测)** | 深度模拟，完美伪装 | 封锁严厉、极易被阻断的宽带 |
| **[2]** | ⚡️ C 语言版 (+TLS) | 极低 | 较弱 (仅表面特征) | 浅层伪装 | 封锁较轻，追求极致聊天刷图速度 |
| **[3]** | ⚡️ C 语言版 (原生) | 极低 | **极易被秒封** | 无 (纯净 `dd` 密钥) | 直连无封锁的环境或中转落地机 |

---

## 🚀 快速开始

下载并运行脚本
只需复制并在终端中执行以下命令：
```bash
wget -O mtproxy.sh https://raw.githubusercontent.com/luiaye/MTProxy/refs/heads/main/mtproxy.sh
chmod +x mtproxy.sh
sudo bash mtproxy.sh

运行后，你将看到如下管理菜单，输入对应数字即可全自动完成配置：
===================================================
Telegram MTProto 代理管理脚本
===================================================
1. 安装 Go 语言版 (mtg) [抗封锁强/延迟略高]
2. 安装 官方 C 语言版 + TLS [延迟极低/推荐]
3. 安装 官方 C 语言版 (无 TLS) [极易被封]
4. 彻底卸载代理 (清理所有版本)
0. 退出脚本
===================================================
请输入选项 [0-4]:
安装流程

• 无论选择哪个版本，系统都会提示你输入 监听端口（默认 33380）。
• 随后会提示输入 Fake-TLS 伪装域名，直接敲回车默认使用 update.microsoft.com（仅针对菜单 1 和菜单 2）。
• 等待自动编译安装完毕，终端将直接打印可一键点击的导入链接 tg://proxy?...。

───

🗑️ 彻底卸载

如果你不想用了，或者服务器需要重装：
运行脚本，在主菜单中选择 [4] 彻底卸载代理。
脚本会自动停用 Systemd 服务，删除二进制编译产物、源码目录及配置文件，还你一个干净的系统。
